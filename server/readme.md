# NetFlows
plugin for OpenNetBattle servers, this plugin lets you create all kinds of interactions on your server without directly writing any code.

[OpenNetBattle server repo](https://github.com/TheMaverickProgrammer/Scriptable-OpenNetBattle-Server)

### example uses
*most of these are not possible yet, but this is the vision*
- trigger a cutscene with all the movements and events defined in the map editor. ✅
- every 10 seconds spawn a bot which follows a path until the end where it despawns ✅
- add simple interact text to objects ✅
- when a player joins the server, send them to a particular location
- when a player presses R, open a menu BBS with many options, trigger any action when any of these are selected.

The plan is that we should be able to do 90% of what the scriptable server is capabile of, without writing any code.

### Installation
simply copy the `netflows` folder into your server folder, eg: `server/scripts/netflows`

### Usage
#### tiled setup
import the custom types from `netflows/propertytypes.json` into your tiled edtior from the toolbar **view** -> **custom types** -> **import**
you will need to redo this step whenever netflows is updated for the latest information.

#### process
TBD

#### examples
have a look at the maps files in this [git repository](https://github.com/Keristero/onb-server-template/tree/ezlibs2)
you could follow the steps download and run it as an example too.

# Documentation
*this section of the documentation is autogenerated so you can rest assured it will always be up to date!*

## $${\color{#ffe119}area}$$
nodes that affect the map

|               class               |            description             |                                    arguments                                    | handlers | output |
|-----------------------------------|------------------------------------|---------------------------------------------------------------------------------|----------|--------|
| play_sound<a id="play_sound"></a> | Play sound for everyone in a map   | <pre>area_id<br>path<br></pre>                                                  |          |        |
| set_tile<a id="set_tile"></a>     | set a specific tile GID            | <pre>area_id<br>x<br>y<br>z<br>tile_gid<br>flip_h<br>flip_v<br>rotate<br></pre> |          |        |
| set_song<a id="set_song"></a>     | Set the background music for a map | <pre>area_id<br>song_path<br></pre>                                             |          |        |

## $${\color{#42d4f4}bot}$$
bot nodes

|                           class                           |                     description                      |                   arguments                    |                                handlers                                |        output         |
|-----------------------------------------------------------|------------------------------------------------------|------------------------------------------------|------------------------------------------------------------------------|-----------------------|
| animate_bot_properties<a id="animate_bot_properties"></a> | Animate bot, does not wait for the animation to end  | <pre>bot_id<br></pre>                          | <pre>first_keyframe_details<br>on_animation_duration_elapsed<br></pre> |                       |
| remove_bot<a id="remove_bot"></a>                         | Remove a bot                                         | <pre>bot_id<br>warp_out?<br></pre>             |                                                                        |                       |
| animate_bot<a id="animate_bot"></a>                       | Animate bot, does not wait for the animation to end. | <pre>bot_id<br>state_name<br>loop<br></pre>    |                                                                        |                       |
| move_bot<a id="move_bot"></a>                             | set bot position                                     | <pre>bot_id<br>x<br>y<br>z<br></pre>           |                                                                        |                       |
| create_bot<a id="create_bot"></a>                         | Create a bot                                         | <pre>bot [bot_details](#bot_details)<br></pre> | <pre>on_actor_interaction<br></pre>                                    | <pre>bot_id<br></pre> |
| set_bot_direction<a id="set_bot_direction"></a>           | set bot position                                     | <pre>bot_id<br>direction<br></pre>             |                                                                        |                       |
| walk_bot<a id="walk_bot"></a>                             | walk bot to location                                 | <pre>bot_id<br>x<br>y<br>z<br></pre>           |                                                                        |                       |

## $${\color{#000075}data}$$
data storage nodes, often referenced by other nodes - not for use in flows

|                           class                           |                                                                description                                                                 |                                                                                                      arguments                                                                                                      |                                                          handlers                                                           | output |
|-----------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------|--------|
| texture_details<a id="texture_details"></a>               | describes a texture                                                                                                                        | <pre>texture_path<br>animation_path <br></pre>                                                                                                                                                                      |                                                                                                                             |        |
| enemy_details<a id="enemy_details"></a>                   | describes an enemy left standing after an encounter                                                                                        | <pre>id<br>health<br></pre>                                                                                                                                                                                         |                                                                                                                             |        |
| object_data_details<a id="object_data_details"></a>       | object data                                                                                                                                | <pre>type<br>gid<br>flipped_horizontally<br>flipped_vertically<br>rotated<br></pre>                                                                                                                                 |                                                                                                                             |        |
| color_details<a id="color_details"></a>                   | describes a color                                                                                                                          | <pre>r<br>g<br>b<br>a<br></pre>                                                                                                                                                                                     |                                                                                                                             |        |
| bot_details<a id="bot_details"></a>                       | describes a bot                                                                                                                            | <pre>area_id<br>warp_in<br>texture_path<br>animation_path<br>animation<br>x<br>y<br>z<br>direction<br>solid<br>name<br></pre>                                                                                       |                                                                                                                             |        |
| object_details<a id="object_details"></a>                 | describes an object                                                                                                                        | <pre>name<br>type<br>visible<br>x<br>y<br>z<br>width<br>height<br>rotation<br>data [data](#data)<br>custom_properties [custom_properties](#custom_properties)<br></pre>                                             |                                                                                                                             |        |
| item_details<a id="item_details"></a>                     | describes an item                                                                                                                          | <pre>name<br>description<br>price?<br></pre>                                                                                                                                                                        |                                                                                                                             |        |
| keyframe_detail_values<a id="keyframe_detail_values"></a> | used by keyframe details, you can specify hardcoded values for the keyframe, if no X,Y,Z is specified, it will use the x,y,z of this node. | <pre>Animation?<br>Animation Speed?<br>X?<br>Y?<br>Z?<br>ScaleX?<br>ScaleY?<br>Rotation?<br>Direction?<br>Sound Effect?<br>Sound Effect Loop?<br></pre>                                                             |                                                                                                                             |        |
| encounter_results<a id="encounter_results"></a>           |                                                                                                                                            |                                                                                                                                                                                                                     | <pre>player_id<br>health<br>score<br>time<br>ran<br>emotion<br>turns<br>enemies[] [enemy_details](#enemy_details)<br></pre> |        |
| transfer_details<a id="transfer_details"></a>             | details for transfer_player                                                                                                                | <pre>player_id<br>area_id<br>warp_in<br>x<br>y<br>z<br>direction<br></pre>                                                                                                                                          |                                                                                                                             |        |
| keyframe_details<a id="keyframe_details"></a>             |                                                                                                                                            | <pre>Animation?<br>Animation Speed?<br>X?<br>Y?<br>Z?<br>ScaleX?<br>ScaleY?<br>Rotation?<br>Direction?<br>Sound Effect?<br>Sound Effect Loop?<br>duration?<br>_next_keyframe?<br>_keyframe_detail_values?<br></pre> |                                                                                                                             |        |

## $${\color{#d4c9ba}dialogue}$$
dialogue related nodes

|                    class                    |                       description                       |                                    arguments                                     |              handlers               |             output             |
|---------------------------------------------|---------------------------------------------------------|----------------------------------------------------------------------------------|-------------------------------------|--------------------------------|
| question_player<a id="question_player"></a> | Send a question to player, _next after answer           | <pre>player_id<br>question<br>mug_texture_path?<br>mug_animation_path?<br></pre> | <pre>on_yes<br>on_no<br></pre>      | <pre>question_answer<br></pre> |
| quiz_player<a id="quiz_player"></a>         | Quiz player, _next after answer                         | <pre>player_id<br>option_a?<br>option_b?<br>option_c?<br></pre>                  | <pre>on_a<br>on_b<br>on_c<br></pre> | <pre>prompt_answer<br></pre>   |
| message_player<a id="message_player"></a>   | Send a textbox to player, _next after textbox is closed | <pre>player_id<br>message<br>mug_texture_path?<br>mug_animation_path?<br></pre>  |                                     |                                |
| prompt_player<a id="prompt_player"></a>     | Prompt player for text, _next after answer              | <pre>player_id<br>character_limit?<br>default_text?<br></pre>                    |                                     | <pre>prompt_answer<br></pre>   |

## $${\color{#f58231}flow}$$
flow control nodes

|          class          |     description     |        arguments        |            handlers             | output |
|-------------------------|---------------------|-------------------------|---------------------------------|--------|
| all<a id="all"></a>     | Do all the things   |                         | <pre>_then2<br>_then3<br></pre> |        |
| sleep<a id="sleep"></a> | Sleep for x seconds | <pre>duration<br></pre> |                                 |        |

## $${\color{#f032e6}misc}$$
various other nodes, for debugging etc

|                              class                              |                                                                                                           description                                                                                                           |                               arguments                                |                                           handlers                                            | output |
|-----------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------|--------|
| unpack<a id="unpack"></a>                                       | specify an table type value from the context, its values will be added to the context, you can also specify new name mappings for each unpacked value. the original table will be removed from the context.                     | <pre>parameter_name<br></pre>                                          |                                                                                               |        |
| print<a id="print"></a>                                         | print some values to the console, you can set the color too                                                                                                                                                                     |                                                                        | <pre>print_label<br>print_context<br>print_node<br>console_color<br>print_parameter<br></pre> |        |
| map<a id="map"></a>                                             | map some variable names to new names, the key should be the current name, and the value should be the new name                                                                                                                  |                                                                        |                                                                                               |        |
| call_function_netflow<a id="call_function_netflow"></a>         | call a function_netflow by name, it can be in any area - and there can be multiple with the same name, as an extra convenience you can define any custom properties you want on this node and they will be added to the context | <pre>function_name<br></pre>                                           | <pre>_on_callback<br></pre>                                                                   |        |
| create_item<a id="create_item"></a>                             | create an item                                                                                                                                                                                                                  | <pre>item_id<br>item_details[] [item_details](#item_details)<br></pre> |                                                                                               |        |
| calc_direction_to_player<a id="calc_direction_to_player"></a>   | gets the current direction from a bot to a player                                                                                                                                                                               | <pre>bot_id<br>player_id<br></pre>                                     |                                                                                               |        |
| function_netflow_callback<a id="function_netflow_callback"></a> | if this node was reached from a call_function_netflow, this node will return all the values in its context back to the _on_callback handler of the call_function_netflow                                                        |                                                                        |                                                                                               |        |

## $${\color{#3cb44b}player}$$
player related nodes

|                              class                              |                       description                       |                                                                arguments                                                                 |                                handlers                                |              output              |
|-----------------------------------------------------------------|---------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------|----------------------------------|
| set_player_health<a id="set_player_health"></a>                 |                                                         | <pre>player_id<br>health<br></pre>                                                                                                       |                                                                        |                                  |
| include_object_for_player<a id="include_object_for_player"></a> | unhide object for a player                              | <pre>player_id<br>object_id<br></pre>                                                                                                    |                                                                        |                                  |
| get_player_emotion<a id="get_player_emotion"></a>               |                                                         | <pre>player_id<br></pre>                                                                                                                 |                                                                        | <pre>emotion<br></pre>           |
| initiate_encounter<a id="initiate_encounter"></a>               | start an encounter for a player                         | <pre>player_id<br>package_path<br>data?<br></pre>                                                                                        |                                                                        | <pre>encounter_results<br></pre> |
| set_player_max_health<a id="set_player_max_health"></a>         |                                                         | <pre>player_id<br>health<br></pre>                                                                                                       |                                                                        |                                  |
| give_player_item<a id="give_player_item"></a>                   |                                                         | <pre>player_id<br>item_id<br></pre>                                                                                                      |                                                                        |                                  |
| get_player_money<a id="get_player_money"></a>                   |                                                         | <pre>player_id<br></pre>                                                                                                                 |                                                                        | <pre>money<br></pre>             |
| animate_player_properties<a id="animate_player_properties"></a> | Animate player, does not wait for the animation to end  | <pre>player_id<br></pre>                                                                                                                 | <pre>first_keyframe_details<br>on_animation_duration_elapsed<br></pre> |                                  |
| get_player_health<a id="get_player_health"></a>                 |                                                         | <pre>player_id<br></pre>                                                                                                                 |                                                                        | <pre>health<br></pre>            |
| remove_player_item<a id="remove_player_item"></a>               |                                                         | <pre>player_id<br>item_id<br></pre>                                                                                                      |                                                                        |                                  |
| player_has_item<a id="player_has_item"></a>                     |                                                         | <pre>player_id<br>item_id<br></pre>                                                                                                      |                                                                        | <pre>player_has_item<br></pre>   |
| animate_player<a id="animate_player"></a>                       | Animate player, does not wait for the animation to end. | <pre>player_id<br>state_name<br>loop?<br></pre>                                                                                          |                                                                        |                                  |
| transfer_player<a id="transfer_player"></a>                     | Transfer player to a location on a map                  | <pre>player_id<br>area_id<br>warp_in<br>x?<br>y?<br>z?<br>direction?<br>target_object_id [transfer_details](#transfer_details)<br></pre> |                                                                        |                                  |
| exclude_object_for_player<a id="exclude_object_for_player"></a> | hide object for a player                                | <pre>player_id<br>object_id<br></pre>                                                                                                    |                                                                        |                                  |
| set_player_emotion<a id="set_player_emotion"></a>               |                                                         | <pre>player_id<br>emotion<br></pre>                                                                                                      |                                                                        |                                  |
| get_player_max_health<a id="get_player_max_health"></a>         |                                                         | <pre>player_id<br></pre>                                                                                                                 |                                                                        | <pre>health<br></pre>            |
| fade_player_camera<a id="fade_player_camera"></a>               | fade camera to color for player                         | <pre>player_id<br>color [color_details](#color_details)<br>durationInSeconds<br></pre>                                                   |                                                                        |                                  |
| initiate_pvp<a id="initiate_pvp"></a>                           | start pvp between two players                           | <pre>player_1_id<br>player_2_id<br>field_script_path?<br></pre>                                                                          |                                                                        | <pre>encounter_results<br></pre> |
| move_player_camera<a id="move_player_camera"></a>               | move player camera                                      | <pre>player_id<br>x<br>y<br>z<br>holdTimeInSeconds?<br></pre>                                                                            |                                                                        |                                  |
| set_player_money<a id="set_player_money"></a>                   |                                                         | <pre>player_id<br>money<br></pre>                                                                                                        |                                                                        |                                  |
| kick_player<a id="kick_player"></a>                             | Kick player from server                                 | <pre>player_id<br>reason<br>warp_out?<br></pre>                                                                                          |                                                                        |                                  |
| unlock_player_camera<a id="unlock_player_camera"></a>           | unlock player camera (back to avatar?)                  | <pre>player_id<br></pre>                                                                                                                 |                                                                        |                                  |
| get_player_mugshot<a id="get_player_mugshot"></a>               | get the player mugshot                                  | <pre>player_id<br></pre>                                                                                                                 |                                                                        | <pre>texture_details<br></pre>   |

## $${\color{#800000}storage}$$
use the data store and save/load context variables

|                  class                  |                                                  description                                                   |                                                      arguments                                                       | handlers | output |
|-----------------------------------------|----------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------|----------|--------|
| save_variable<a id="save_variable"></a> | save variable from the context to the data store, you can save values with an alias using saved_variable_name  | <pre>unique_to_player_secret?<br>unique_to_area_id?<br>saved_variable_name?<br>variable_name<br>table_key?<br></pre> |          |        |
| load_variable<a id="load_variable"></a> | load variable from the  data store to the context, you can load values with an alias using saved_variable_name | <pre>unique_to_player_secret?<br>unique_to_area_id?<br>saved_variable_name?<br>variable_name<br>table_key?<br></pre> |          |        |

## $${\color{#911eb4}tile}$$
nodes that the player actually interacts with on the map, all other types are removed from the map on boot.

|                 class                 |          description          |              arguments               | handlers | output |
|---------------------------------------|-------------------------------|--------------------------------------|----------|--------|
| Custom Warp<a id="Custom Warp"></a>   | triggers when stepped on      | <pre>on_custom_warp<br></pre>        |          |        |
| Interactable<a id="Interactable"></a> | triggers when interacted with | <pre>on_object_interaction<br></pre> |          |        |

## $${\color{#e6194B}trigger}$$
used for beginning flows from server events

|                            class                            |                               description                                | arguments |                                                  handlers                                                  | output |
|-------------------------------------------------------------|--------------------------------------------------------------------------|-----------|------------------------------------------------------------------------------------------------------------|--------|
| on_player_area_transfer<a id="on_player_area_transfer"></a> | triggers when a player transfers area                                    |           |                                                                                                            |        |
| on_actor_interaction<a id="on_actor_interaction"></a>       | triggers when a player interacts with a actor                            |           |                                                                                                            |        |
| function_netflow<a id="function_netflow"></a>               | can be triggered by any call_function node with a matching function_name |           | <pre>function_name<br></pre>                                                                               |        |
| collider_trigger<a id="collider_trigger"></a>               | triggers when a player enters the collider                               |           | <pre>on_player_enters_collider<br>on_player_exits_collider<br>on_player_movement_within_collider<br></pre> |        |
| on_start<a id="on_start"></a>                               | triggers immediately once the plugin finishes loading                    |           |                                                                                                            |        |

## $${\color{#aaffc3}object}$$
interacting with objects

|                  class                  |   description    |                                 arguments                                  | handlers | output |
|-----------------------------------------|------------------|----------------------------------------------------------------------------|----------|--------|
| create_object<a id="create_object"></a> | Create an object | <pre>area_id<br>object_details [object_details](#object_details)<br></pre> |          |        |
| remove_object<a id="remove_object"></a> | remove an object | <pre>area_id<br>object_id<br></pre>                                        |          |        |

