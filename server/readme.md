# NetFlows
plugin for OpenNetBattle servers, this plugin lets you create all kinds of interactions on your server without directly writing any code.

[OpenNetBattle server repo](https://github.com/TheMaverickProgrammer/Scriptable-OpenNetBattle-Server)

### example uses
*most of these are not possible yet, but this is the vision*
- trigger a cutscene with all the movements and events defined in the map editor.
- every 10 seconds spawn a bot which follows a path until the end where it despawns
- add simple interact text to objects âœ…
- when a player joins the server, send them to a particular location
- when a player presses R, open a menu BBS with many options, trigger any action when any of these are selected.

The plan is that we should be able to do 90% of what the scriptable server is capabile of, without writing any code.

### Installation
simply copy the `netflows` folder into your server folder, eg: `server/scripts/netflows`

### Usage
#### tiled setup
*note, the following instructions are not correct yet, currently the tile definitions are in the example server.tiled-project in the `onb-server-template` ezlibs2 branch*

import the custom types from `netflows/custom_types` into your tiled edtior from the toolbar **view** -> **custom types** -> **import**

this will give you a complete list of all the classes supported by this library, when you create a object in tiled you will be able to select a class

#### process
TBD

#### examples
have a look at the maps files in this [git repository](https://github.com/Keristero/onb-server-template/tree/ezlibs2)
you could follow the steps download and run it as an example too.

# Documentation
*this section of the documentation is autogenerated so you can rest assured it will always be up to date!*

## $${\color{#ffe119}area}$$
nodes that affect the map

|   class    |            description             |                                    arguments                                    | handlers | output |
|------------|------------------------------------|---------------------------------------------------------------------------------|----------|--------|
| play_sound | Play sound for everyone in a map   | <pre>area_id<br>path<br></pre>                                                  |          |        |
| set_song   | Set the background music for a map | <pre>area_id<br>song_path<br></pre>                                             |          |        |
| set_tile   | set a specific tile GID            | <pre>area_id<br>x<br>y<br>z<br>tile_gid<br>flip_h<br>flip_v<br>rotate<br></pre> |          |        |

## $${\color{#42d4f4}bot}$$
bot nodes

|       class       |     description      |              arguments               |              handlers               |        output         |
|-------------------|----------------------|--------------------------------------|-------------------------------------|-----------------------|
| move_bot          | set bot position     | <pre>bot_id<br>x<br>y<br>z<br></pre> |                                     |                       |
| create_bot        | Create a bot         | <pre>bot<br></pre>                   | <pre>on_actor_interaction<br></pre> | <pre>bot_id<br></pre> |
| walk_bot          | walk bot to location | <pre>bot_id<br>x<br>y<br>z<br></pre> |                                     |                       |
| remove_bot        | Remove a bot         | <pre>bot_id<br>warp_out<br></pre>    |                                     |                       |
| set_bot_direction | set bot position     | <pre>bot_id<br>direction<br></pre>   |                                     |                       |

## $${\color{#bfef45}data}$$
data storage nodes, often referenced by other nodes

|        class        |         description         |                                                           arguments                                                           | handlers | output |
|---------------------|-----------------------------|-------------------------------------------------------------------------------------------------------------------------------|----------|--------|
| object_details      | describes an object         | <pre>name<br>type<br>visible<br>x<br>y<br>z<br>width<br>height<br>rotation<br>data<br>custom_properties<br></pre>             |          |        |
| bot_details         | describes a bot             | <pre>area_id<br>warp_in<br>texture_path<br>animation_path<br>animation<br>x<br>y<br>z<br>direction<br>solid<br>name<br></pre> |          |        |
| texture_details     | describes a texture         | <pre>texture_path<br>animation_path <br></pre>                                                                                |          |        |
| object_data_details | object data                 | <pre>type<br>gid<br>flipped_horizontally<br>flipped_vertically<br>rotated<br></pre>                                           |          |        |
| transfer_details    | details for transfer_player | <pre>player_id<br>area_id<br>warp_in<br>x<br>y<br>z<br>direction<br></pre>                                                    |          |        |

## $${\color{#e6194B}dialogue}$$
dialogue related nodes

|      class      |                       description                       |                                   arguments                                    |            handlers            |             output             |
|-----------------|---------------------------------------------------------|--------------------------------------------------------------------------------|--------------------------------|--------------------------------|
| question_player | Send a question to player, _next after answer           | <pre>player_id<br>question<br>mug_texture_path<br>mug_animation_path<br></pre> | <pre>on_yes<br>on_no<br></pre> | <pre>question_answer<br></pre> |
| message_player  | Send a textbox to player, _next after textbox is closed | <pre>player_id<br>message<br>mug_texture_path<br>mug_animation_path<br></pre>  |                                |                                |

## $${\color{#f032e6}flow}$$
flow control nodes

| class |     description     |        arguments        |            handlers             | output |
|-------|---------------------|-------------------------|---------------------------------|--------|
| sleep | Sleep for x seconds | <pre>duration<br></pre> |                                 |        |
| all   | Do all the things   |                         | <pre>_then2<br>_then3<br></pre> |        |

## $${\color{#911eb4}misc}$$
various other nodes, for debugging etc

|          class           |                                                                                                 description                                                                                                 |             arguments              |                                           handlers                                            | output |
|--------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------|-----------------------------------------------------------------------------------------------|--------|
| print                    | print some values to the console, you can set the color too                                                                                                                                                 |                                    | <pre>print_label<br>print_context<br>print_node<br>console_color<br>print_parameter<br></pre> |        |
| call_function_netflow    | call a function_netflow by name, it can be in any area - and there can be multiple with the same name                                                                                                       | <pre>function_name<br></pre>       |                                                                                               |        |
| unpack                   | specify an table type value from the context, its values will be added to the context, you can also specify new name mappings for each unpacked value. the original table will be removed from the context. | <pre>parameter_name<br></pre>      |                                                                                               |        |
| calc_direction_to_player | gets the current direction from a bot to a player                                                                                                                                                           | <pre>bot_id<br>player_id<br></pre> |                                                                                               |        |

## $${\color{#3cb44b}player}$$
player related nodes

|           class           |              description               |                                           arguments                                            |      handlers       |             output             |
|---------------------------|----------------------------------------|------------------------------------------------------------------------------------------------|---------------------|--------------------------------|
| include_object_for_player | unhide object for a player             | <pre>player_id<br>object_id<br></pre>                                                          |                     |                                |
| exclude_object_for_player | hide object for a player               | <pre>player_id<br>object_id<br></pre>                                                          |                     |                                |
| kick_player               | Kick player from server                | <pre>player_id<br>reason<br>warp_out<br></pre>                                                 |                     |                                |
| get_player_mugshot        | get the player mugshot                 | <pre>player_id<br></pre>                                                                       |                     | <pre>texture_details<br></pre> |
| initiate_encounter        | start an encounter for a player        | <pre>player_id<br>package_path<br></pre>                                                       | <pre>data<br></pre> |                                |
| transfer_player           | Transfer player to a location on a map | <pre>player_id<br>area_id<br>warp_in<br>x<br>y<br>z<br>direction<br>target_object_id<br></pre> |                     |                                |

## $${\color{#4363d8}tile}$$
nodes that the player actually interacts with on the map, all other types are removed from the map on boot.

|    class     |          description          |              arguments               | handlers | output |
|--------------|-------------------------------|--------------------------------------|----------|--------|
| Interactable | triggers when interacted with | <pre>on_object_interaction<br></pre> |          |        |
| Custom Warp  | triggers when stepped on      | <pre>on_custom_warp<br></pre>        |          |        |

## $${\color{#f58231}trigger}$$
used for beginning flows from server events

|          class          |                               description                                | arguments |                                                  handlers                                                  | output |
|-------------------------|--------------------------------------------------------------------------|-----------|------------------------------------------------------------------------------------------------------------|--------|
| function_netflow        | can be triggered by any call_function node with a matching function_name |           | <pre>function_name<br></pre>                                                                               |        |
| on_start                | triggers immediately once the plugin finishes loading                    |           |                                                                                                            |        |
| collider_trigger        | triggers when a player enters the collider                               |           | <pre>on_player_enters_collider<br>on_player_exits_collider<br>on_player_movement_within_collider<br></pre> |        |
| on_actor_interaction    | triggers when a player interacts with a actor                            |           |                                                                                                            |        |
| on_player_area_transfer | triggers when a player transfers area                                    |           |                                                                                                            |        |

## $${\color{#fabed4}object}$$
interacting with objects

|     class     |   description    |                arguments                 | handlers | output |
|---------------|------------------|------------------------------------------|----------|--------|
| create_object | Create an object | <pre>area_id<br>object_details<br></pre> |          |        |
| remove_object | remove an object | <pre>area_id<br>object_id<br></pre>      |          |        |

